<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .dashboard-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .user-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
<div class="dashboard-container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Dashboard</a>
            <button class="btn btn-outline-danger" onclick="handleLogout()">Logout</button>
        </div>
    </nav>

    <div class="user-info">
        <h3>Welcome <span id="username"></span></h3>
        <p>Role: <span id="userRole"></span></p>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Your Profile</h5>
            <div id="profileData"></div>
        </div>
    </div>
</div>

<script>
    // Check if user is authenticated
    function checkAuth() {
        const token = localStorage.getItem('accessToken');
        if (!token) {
            window.location.href = '/login';
        }
        return token;
    }

    // Load user profile
    async function loadProfile() {
        const token = checkAuth();
        try {
            const response = await fetch('/api/users/profile', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (response.ok) {
                const profile = await response.json();
                document.getElementById('username').textContent = profile.username;
                document.getElementById('userRole').textContent = profile.role;

                // Display additional profile data
                const profileData = document.getElementById('profileData');
                profileData.innerHTML = `
                        <p>Account Status: ${profile.accountNonLocked ? 'Active' : 'Locked'}</p>
                        <p>Last Login: ${new Date().toLocaleDateString()}</p>
                    `;
            } else {
                handleLogout();
            }
        } catch (error) {
            console.error('Error loading profile:', error);
            handleLogout();
        }
    }

    // Handle logout
    async function handleLogout() {
        const token = localStorage.getItem('accessToken');
        try {
            await fetch('/api/auth/logout', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
        } finally {
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            window.location.href = '/login';
        }
    }

    // Load profile when page loads
    document.addEventListener('DOMContentLoaded', loadProfile);
</script>
</body>
</html>